<!DOCTYPE html>
<html>
<head>
  <link href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css" rel="stylesheet">
</head>

<body ng-app='app'>
  <div ng-controller='DataCtrl' class='container'>
    <h1>Recent Requests</h1>

    <!-- This is for adding requests -->
    <form role='form'>
      <div class='form-group'>
        <label>To</label>
        <input ng-model='requestEmail' class='form-control' placeholder='Email:' />
      </div>
      <div class='form-group'>
        <label>Subject</label>
        <input ng-model='requestSubject' class='form-control' placeholder='Subject:' />
      </div>
      <div class='form-group'>
        <label>Request Items</label>
        <textarea rows='5' ng-model='requestText' class='form-control'></textarea>
      </div>
        <button ng-click='makeRequest()' class='btn btn-default btn-primary'>Make Request</button>
    </form>

    <!-- This is the requests list -->
    <ul class='list-group'>
      <li ng-repeat='request in requests | orderBy: "-date"' class='list-group-item'>
        <div>
          <strong>{{ request.parentUser }}</strong>
          <span ng-if="!request.response"> requested </span>
          <span ng-if="request.response"> received a response to </span>
          <strong>{{ request.subject }}</strong> on <strong>{{ request.date }}</strong>
        </div>
      </li>
    </ul>


  <!-- This is for testing what data is being sent in -->
    {{ requests }}
    {{ users }}
  </div>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.min.js"></script>
  <script>
    var app = angular.module('app',[])
    app.controller('DataCtrl', function ($scope, $http) {
      $scope.makeRequest = function () {
        if ($scope.requestText) {
          $http.post('/api/requests', {
            parentUser: 'eli',
            date: Date.now,
            response: false,
            to: $scope.requestEmail,
            subject: $scope.requestSubject,
            text: $scope.requestText,
            html: null,
            responseText: "This is what the request returned",
            attachment: "Find a way to handle attachments"
          }).success(function (request) {
            $scope.requests.unshift(request)
            $scope.requestText = null
            $scope.requestEmail = null
            $scope.requestSubject = null
          })
        }
      }

      $http.get('http://127.0.0.1:3000/api/requests')
      .success(function (requests) {
        console.log('getting requests')
        $scope.requests = requests
      })

      $scope.users = [
      {
        username : "dickeyxxx",
        password : "pass",
        email: "trevor@myemail.com",
        organization: "The Daily Illini",
        position: "Reporter",
        lineOne: "555 W Orange St.",
        lineTwo: "P.O. box 32",
        city: "Urbana",
        state: "Illinois",
        postal: "61061"
      },
      {
        username : "Michael Joseph",
        password : "ghost",
        email: "Mikey@myemail.com",
        organization: "News Herald",
        position: "Editor",
        lineOne: "666 W Yellow St.",
        lineTwo: "Apt. #706",
        city: "Champaign",
        state: "Wyoming",
        postal: "61616"
      }
    ]
  })
  </script>
</body>
</html>
